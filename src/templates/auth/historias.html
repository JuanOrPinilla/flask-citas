{% extends './base_template.html' %}

{% block title %}SignUp{% endblock %}

{% block customCSS %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/historias.css') }}">
{% endblock %}

{% block body %}
<body>
  <h1>Historias Clínicas:</h1>
  <table class="center" id="pacientes-table">
      <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Cédula</th>
      </tr>
      {% for paciente in json_data %}
      <tr class="popup-trigger" data-id="{{ paciente.id }}">
          <td>{{ paciente.id }}</td>
          <td>{{ paciente.nombre }}</td>
          <td>{{ paciente.cedula }}</td>
      </tr>
      {% endfor %}
  </table>

  <div id="popup" class="popup">
      <div class="popup-content">
          <span class="popup-close" onclick="closePopup()">&times;</span>
          <h2>Detalles de la Historia Médica</h2>
          <table id="detalles-table">
              <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>Cédula</th>
                  <th>Fecha de Nacimiento</th>
                  <th>Tipo de Sangre</th>
                  <th>Fecha del Examen</th>
                  <th>Enfermedades</th>
                  <th>Medicamentos</th>
                  <th>Alergias</th>
              </tr>
          </table>
      </div>
  </div>

  <script>
    function openPopup() {
        var popup = document.getElementById('popup');
        popup.style.display = 'block';
    }

    function closePopup() {
        var popup = document.getElementById('popup');
        popup.style.display = 'none';
    }

    function loadPatientDetails(patientId) {
    // Obtiene los datos del paciente del objeto JSON
    var patient = json_data[patientId];
    if (patient) {
        var table = document.getElementById('detalles-table');
        
        // Limpia la tabla antes de llenarla con nuevos detalles
        table.innerHTML = "";

        // Crea una fila para cada atributo del paciente
        for (var key in patient) {
            if (patient.hasOwnProperty(key)) {
                var row = table.insertRow();
                var keyCell = row.insertCell(0);
                var valueCell = row.insertCell(1);

                keyCell.textContent = key;
                valueCell.textContent = patient[key];
            }
        }
    }
}

    document.addEventListener('DOMContentLoaded', function() {
        var popupTriggers = document.querySelectorAll('.popup-trigger');
        for (var i = 0; i < popupTriggers.length; i++) {
            popupTriggers[i].addEventListener('click', function() {
                openPopup();
                var patientId = this.getAttribute('data-id');
                loadPatientDetails(patientId);
            });
        }
    });
  </script>
</body>
{% endblock %}